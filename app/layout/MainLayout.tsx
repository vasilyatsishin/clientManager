import { FC, ReactNode, useCallback, useMemo, useRef, useState } from "react";
import {
  View,
  StatusBar,
  StyleSheet,
  TouchableOpacity,
  Text,
  Image,
  Animated,
  Modal,
} from "react-native";
import { useSelector } from "react-redux";
import { RootState } from "../redux/store";
import { SafeAreaProvider, SafeAreaView } from "react-native-safe-area-context";
import { colors } from "../assets/colors";
import { useNavigation } from "@react-navigation/native";
import { NativeStackNavigationProp } from "@react-navigation/native-stack";
import { TypeRootStackParamList } from "../navigation/types";
import UserMenu from "./UserMenu";
import { BlurView } from "expo-blur";
import { SvgXml } from "react-native-svg";
import { useDispatch } from "react-redux";
import { setIsMainLayoutShown } from "../redux/slices/generalSlice";

interface MainLayoutProps {
  children: ReactNode;
  activePage: string;
}

const MainLayout: FC<MainLayoutProps> = ({ children, activePage }) => {
  const theme = useSelector((state: RootState) => state.generalSlice.theme);
  const dispatch = useDispatch()
  const navigation =
    useNavigation<NativeStackNavigationProp<TypeRootStackParamList>>();
  const [isMenuOpen, setIsMenuOpen] = useState(false);
  const [isActionMenuOpen, setIsActionMenuOpen] = useState(false);
  const rotationAnim = useRef(new Animated.Value(0)).current;
  const isMainLayoutShown = useSelector(
    (state: RootState) => state.generalSlice.isMainLayoutShown
  );

  const toggleRotation = useCallback(() => {
    Animated.timing(rotationAnim, {
      toValue: isActionMenuOpen ? 0 : 1,
      duration: 150,
      useNativeDriver: true,
    }).start();
    setTimeout(() => {
      setIsActionMenuOpen(!isActionMenuOpen);
    }, 50);
  }, [isActionMenuOpen, rotationAnim]);

  const newIcon = `<svg width="17" height="34" viewBox="0 0 17 34" fill="none" xmlns="http://www.w3.org/2000/svg">
<g id="Group 2673">
<path id="Vector (Stroke)" fill-rule="evenodd" clip-rule="evenodd" d="M0 2.14286C0 0.959387 0.951404 0 2.125 0H14.875C16.0486 0 17 0.959396 17 2.14286V17.8571C17 19.0406 16.0486 20 14.875 20H2.125C0.951411 20 0 19.0406 0 17.8571V2.14286ZM1.41667 15.7143V17.8571C1.41667 18.2516 1.7338 18.5714 2.125 18.5714H14.875C15.2662 18.5714 15.5833 18.2517 15.5833 17.8571V15.7143H1.41667ZM15.5833 14.2857H1.41667V2.14286C1.41667 1.74837 1.7338 1.42857 2.125 1.42857H14.875C15.2662 1.42857 15.5833 1.74836 15.5833 2.14286V14.2857ZM4.25 4.28571C4.25 3.89123 4.56713 3.57143 4.95833 3.57143H12.0417C12.4329 3.57143 12.75 3.89123 12.75 4.28571C12.75 4.6802 12.4329 5 12.0417 5H4.95833C4.56713 5 4.25 4.6802 4.25 4.28571ZM4.25 7.85714C4.25 7.46265 4.56713 7.14286 4.95833 7.14286H12.0417C12.4329 7.14286 12.75 7.46265 12.75 7.85714C12.75 8.25163 12.4329 8.57143 12.0417 8.57143H4.95833C4.56713 8.57143 4.25 8.25163 4.25 7.85714ZM4.25 11.4286C4.25 11.0341 4.56713 10.7143 4.95833 10.7143H9.20833C9.59953 10.7143 9.91667 11.0341 9.91667 11.4286C9.91667 11.8231 9.59953 12.1429 9.20833 12.1429H4.95833C4.56713 12.1429 4.25 11.8231 4.25 11.4286Z" fill="${
    activePage == "Невідправлені" ? "#6EA8DB" : "#C9C9C9"
  }"/>
<path id="&#208;&#157;&#208;&#190;&#208;&#178;&#209;&#150;" d="M4.277 27.1H4.977V32H4.277V27.1ZM1.463 32H0.763V27.1H1.463V32ZM4.34 29.816H1.393V29.207H4.34V29.816ZM7.98219 32.042C7.60885 32.042 7.27752 31.9603 6.98819 31.797C6.69885 31.6337 6.47019 31.4097 6.30219 31.125C6.13419 30.8357 6.05019 30.509 6.05019 30.145C6.05019 29.7763 6.13419 29.4497 6.30219 29.165C6.47019 28.8803 6.69885 28.6587 6.98819 28.5C7.27752 28.3367 7.60885 28.255 7.98219 28.255C8.35085 28.255 8.67985 28.3367 8.96919 28.5C9.26319 28.6587 9.49185 28.8803 9.65519 29.165C9.82319 29.445 9.90719 29.7717 9.90719 30.145C9.90719 30.5137 9.82319 30.8403 9.65519 31.125C9.49185 31.4097 9.26319 31.6337 8.96919 31.797C8.67985 31.9603 8.35085 32.042 7.98219 32.042ZM7.98219 31.454C8.22019 31.454 8.43252 31.4003 8.61919 31.293C8.81052 31.1857 8.95985 31.034 9.06719 30.838C9.17452 30.6373 9.22819 30.4063 9.22819 30.145C9.22819 29.879 9.17452 29.6503 9.06719 29.459C8.95985 29.263 8.81052 29.1113 8.61919 29.004C8.43252 28.8967 8.22019 28.843 7.98219 28.843C7.74419 28.843 7.53185 28.8967 7.34519 29.004C7.15852 29.1113 7.00919 29.263 6.89719 29.459C6.78519 29.6503 6.72919 29.879 6.72919 30.145C6.72919 30.4063 6.78519 30.6373 6.89719 30.838C7.00919 31.034 7.15852 31.1857 7.34519 31.293C7.53185 31.4003 7.74419 31.454 7.98219 31.454ZM10.8776 32V28.29H12.5996C13.0336 28.29 13.3742 28.374 13.6216 28.542C13.8736 28.7053 13.9996 28.9387 13.9996 29.242C13.9996 29.5453 13.8806 29.781 13.6426 29.949C13.4092 30.1123 13.0989 30.194 12.7116 30.194L12.8166 30.012C13.2599 30.012 13.5889 30.0937 13.8036 30.257C14.0182 30.4203 14.1256 30.6607 14.1256 30.978C14.1256 31.3 14.0042 31.552 13.7616 31.734C13.5236 31.9113 13.1572 32 12.6626 32H10.8776ZM11.5356 31.482H12.6136C12.8936 31.482 13.1036 31.44 13.2436 31.356C13.3836 31.2673 13.4536 31.1273 13.4536 30.936C13.4536 30.74 13.3882 30.5977 13.2576 30.509C13.1316 30.4157 12.9309 30.369 12.6556 30.369H11.5356V31.482ZM11.5356 29.886H12.5436C12.8002 29.886 12.9939 29.8393 13.1246 29.746C13.2599 29.648 13.3276 29.5127 13.3276 29.34C13.3276 29.1627 13.2599 29.0297 13.1246 28.941C12.9939 28.8523 12.8002 28.808 12.5436 28.808H11.5356V29.886ZM15.1774 32V28.29H15.8494V32H15.1774ZM15.5134 27.576C15.3827 27.576 15.273 27.534 15.1844 27.45C15.1004 27.366 15.0584 27.2633 15.0584 27.142C15.0584 27.016 15.1004 26.911 15.1844 26.827C15.273 26.743 15.3827 26.701 15.5134 26.701C15.644 26.701 15.7514 26.743 15.8354 26.827C15.924 26.9063 15.9684 27.0067 15.9684 27.128C15.9684 27.254 15.9264 27.3613 15.8424 27.45C15.7584 27.534 15.6487 27.576 15.5134 27.576Z" fill=${
    activePage == "Невідправлені" ? "#6EA8DB" : "#C9C9C9"
  }/>
</g>
</svg>
`;

  const sended = `<svg width="46" height="34" viewBox="0 0 46 34" fill="none" xmlns="http://www.w3.org/2000/svg">
<g id="Group 2674">
<g id="Vector (Stroke)">
<path fill-rule="evenodd" clip-rule="evenodd" d="M29.5378 0.53617C28.9731 0.186066 28.3216 0.00035188 27.6571 0H18.3429L18.3245 0.000235822C17.6753 0.0169216 17.043 0.210296 16.4955 0.55955C15.9499 0.907592 15.5092 1.3973 15.2204 1.97632L13.0803 6.09952C13.0275 6.20118 13 6.31403 13 6.42857V17.8571C13 18.4254 13.2257 18.9706 13.6277 19.3724C14.0295 19.7741 14.5745 20 15.1429 20H30.8571C31.4255 20 31.9706 19.7742 32.3724 19.3724C32.7742 18.9706 33 18.4255 33 17.8571V6.42857C33 6.31735 32.974 6.20766 32.9241 6.10825L30.8533 1.98089C30.5576 1.38648 30.1021 0.88612 29.5378 0.53617ZM22.2857 1.42857H18.3527C17.9662 1.44004 17.5899 1.5559 17.2638 1.76392C16.9353 1.97348 16.6702 2.26863 16.4969 2.61762L16.4912 2.62911L14.8898 5.71429H22.2857V1.42857ZM23.7143 5.71429V1.42857H27.6569C28.0554 1.42885 28.4462 1.54029 28.7851 1.75034C29.1238 1.96041 29.3972 2.26084 29.5746 2.61789L29.5759 2.62032L31.1282 5.71429H23.7143ZM14.4286 7.14286V17.8571C14.4286 18.0466 14.5039 18.2283 14.6377 18.3622C14.7718 18.4962 14.9535 18.5714 15.1429 18.5714H30.8571C31.0465 18.5714 31.2283 18.4961 31.3622 18.3622C31.4961 18.2283 31.5714 18.0465 31.5714 17.8571V7.14286H14.4286Z" fill="${
    activePage == "Відправлені" ? "#6EA8DB" : "#C9C9C9"
  }"/>
<path d="M23.7136 9.57816C23.7136 9.18367 23.3938 8.86387 22.9993 8.86387C22.6049 8.86387 22.2851 9.18367 22.2851 9.57816V14.4838L21.0045 13.2032C20.7255 12.9243 20.2733 12.9243 19.9943 13.2033C19.7154 13.4822 19.7154 13.9345 19.9943 14.2134L22.4946 16.7137C22.7736 16.9926 23.2258 16.9926 23.5048 16.7137L26.0051 14.2134C26.284 13.9345 26.284 13.4822 26.0051 13.2033C25.7261 12.9243 25.2739 12.9243 24.9949 13.2032L23.7136 14.4845V9.57816Z" fill="${
    activePage == "Відправлені" ? "#6EA8DB" : "#C9C9C9"
  }"/>
</g>
<path id="&#208;&#146;&#209;&#150;&#208;&#180;&#208;&#191;&#209;&#128;&#208;&#176;&#208;&#178;&#208;&#187;&#208;&#181;&#208;&#189;&#209;&#150;" d="M0.763 32V27.1H2.87C3.402 27.1 3.81967 27.2073 4.123 27.422C4.42633 27.6367 4.578 27.9493 4.578 28.36C4.578 28.7613 4.43333 29.0693 4.144 29.284C3.85467 29.494 3.47433 29.599 3.003 29.599L3.129 29.389C3.675 29.389 4.09267 29.4987 4.382 29.718C4.676 29.9327 4.823 30.2477 4.823 30.663C4.823 31.083 4.669 31.412 4.361 31.65C4.05767 31.8833 3.605 32 3.003 32H0.763ZM1.456 31.447H2.989C3.36233 31.447 3.64233 31.3793 3.829 31.244C4.02033 31.104 4.116 30.8917 4.116 30.607C4.116 30.3223 4.02033 30.1147 3.829 29.984C3.64233 29.8533 3.36233 29.788 2.989 29.788H1.456V31.447ZM1.456 29.256H2.821C3.16167 29.256 3.42067 29.1883 3.598 29.053C3.78 28.9177 3.871 28.7193 3.871 28.458C3.871 28.192 3.78 27.9913 3.598 27.856C3.42067 27.7207 3.16167 27.653 2.821 27.653H1.456V29.256ZM5.88049 32V28.29H6.55249V32H5.88049ZM6.21649 27.576C6.08583 27.576 5.97616 27.534 5.88749 27.45C5.80349 27.366 5.76149 27.2633 5.76149 27.142C5.76149 27.016 5.80349 26.911 5.88749 26.827C5.97616 26.743 6.08583 26.701 6.21649 26.701C6.34716 26.701 6.45449 26.743 6.53849 26.827C6.62716 26.9063 6.67149 27.0067 6.67149 27.128C6.67149 27.254 6.62949 27.3613 6.54549 27.45C6.46149 27.534 6.35183 27.576 6.21649 27.576ZM10.3969 31.685V28.878H8.78691L8.75191 29.592C8.74258 29.8253 8.72625 30.0517 8.70291 30.271C8.68425 30.4857 8.65158 30.684 8.60491 30.866C8.56291 31.048 8.49991 31.1973 8.41591 31.314C8.33191 31.4307 8.21991 31.503 8.07991 31.531L7.41491 31.412C7.55958 31.4167 7.67625 31.37 7.76491 31.272C7.85358 31.1693 7.92125 31.0293 7.96791 30.852C8.01925 30.6747 8.05658 30.474 8.07991 30.25C8.10325 30.0213 8.12191 29.7857 8.13591 29.543L8.19191 28.29H11.0689V31.685H10.3969ZM7.26791 32.861V31.412H11.6359V32.861H11.0059V32H7.90491V32.861H7.26791ZM12.5114 32V28.29H15.9484V32H15.2764V28.71L15.4374 28.878H13.0224L13.1834 28.71V32H12.5114ZM19.2157 32.042C18.9077 32.042 18.6253 31.972 18.3687 31.832C18.1167 31.6873 17.9137 31.475 17.7597 31.195C17.6103 30.915 17.5357 30.565 17.5357 30.145C17.5357 29.725 17.608 29.375 17.7527 29.095C17.902 28.815 18.1027 28.605 18.3547 28.465C18.6113 28.325 18.8983 28.255 19.2157 28.255C19.5797 28.255 19.9017 28.3343 20.1817 28.493C20.4617 28.6517 20.6833 28.8733 20.8467 29.158C21.01 29.438 21.0917 29.767 21.0917 30.145C21.0917 30.523 21.01 30.8543 20.8467 31.139C20.6833 31.4237 20.4617 31.6453 20.1817 31.804C19.9017 31.9627 19.5797 32.042 19.2157 32.042ZM17.2487 33.358V28.29H17.8927V29.291L17.8507 30.152L17.9207 31.013V33.358H17.2487ZM19.1597 31.454C19.3977 31.454 19.61 31.4003 19.7967 31.293C19.988 31.1857 20.1373 31.034 20.2447 30.838C20.3567 30.6373 20.4127 30.4063 20.4127 30.145C20.4127 29.879 20.3567 29.6503 20.2447 29.459C20.1373 29.263 19.988 29.1113 19.7967 29.004C19.61 28.8967 19.3977 28.843 19.1597 28.843C18.9263 28.843 18.714 28.8967 18.5227 29.004C18.336 29.1113 18.1867 29.263 18.0747 29.459C17.9673 29.6503 17.9137 29.879 17.9137 30.145C17.9137 30.4063 17.9673 30.6373 18.0747 30.838C18.1867 31.034 18.336 31.1857 18.5227 31.293C18.714 31.4003 18.9263 31.454 19.1597 31.454ZM24.3088 32V31.216L24.2738 31.069V29.732C24.2738 29.4473 24.1898 29.228 24.0218 29.074C23.8585 28.9153 23.6111 28.836 23.2798 28.836C23.0605 28.836 22.8458 28.8733 22.6358 28.948C22.4258 29.018 22.2485 29.1137 22.1038 29.235L21.8238 28.731C22.0151 28.577 22.2438 28.4603 22.5098 28.381C22.7805 28.297 23.0628 28.255 23.3568 28.255C23.8655 28.255 24.2575 28.3787 24.5328 28.626C24.8081 28.8733 24.9458 29.2513 24.9458 29.76V32H24.3088ZM23.0908 32.042C22.8155 32.042 22.5728 31.9953 22.3628 31.902C22.1575 31.8087 21.9988 31.6803 21.8868 31.517C21.7748 31.349 21.7188 31.16 21.7188 30.95C21.7188 30.7493 21.7655 30.5673 21.8588 30.404C21.9568 30.2407 22.1131 30.11 22.3278 30.012C22.5471 29.914 22.8411 29.865 23.2098 29.865H24.3858V30.348H23.2378C22.9018 30.348 22.6755 30.404 22.5588 30.516C22.4421 30.628 22.3838 30.7633 22.3838 30.922C22.3838 31.104 22.4561 31.251 22.6008 31.363C22.7455 31.4703 22.9461 31.524 23.2028 31.524C23.4548 31.524 23.6741 31.468 23.8608 31.356C24.0521 31.244 24.1898 31.0807 24.2738 30.866L24.4068 31.328C24.3181 31.5473 24.1618 31.7223 23.9378 31.853C23.7138 31.979 23.4315 32.042 23.0908 32.042ZM26.1559 32V28.29H27.8779C28.3119 28.29 28.6525 28.374 28.8999 28.542C29.1519 28.7053 29.2779 28.9387 29.2779 29.242C29.2779 29.5453 29.1589 29.781 28.9209 29.949C28.6875 30.1123 28.3772 30.194 27.9899 30.194L28.0949 30.012C28.5382 30.012 28.8672 30.0937 29.0819 30.257C29.2965 30.4203 29.4039 30.6607 29.4039 30.978C29.4039 31.3 29.2825 31.552 29.0399 31.734C28.8019 31.9113 28.4355 32 27.9409 32H26.1559ZM26.8139 31.482H27.8919C28.1719 31.482 28.3819 31.44 28.5219 31.356C28.6619 31.2673 28.7319 31.1273 28.7319 30.936C28.7319 30.74 28.6665 30.5977 28.5359 30.509C28.4099 30.4157 28.2092 30.369 27.9339 30.369H26.8139V31.482ZM26.8139 29.886H27.8219C28.0785 29.886 28.2722 29.8393 28.4029 29.746C28.5382 29.648 28.6059 29.5127 28.6059 29.34C28.6059 29.1627 28.5382 29.0297 28.4029 28.941C28.2722 28.8523 28.0785 28.808 27.8219 28.808H26.8139V29.886ZM29.8397 31.993L29.8817 31.426C29.9144 31.4307 29.9447 31.4353 29.9727 31.44C30.0007 31.4447 30.0264 31.447 30.0497 31.447C30.199 31.447 30.3157 31.3957 30.3997 31.293C30.4884 31.1903 30.5537 31.055 30.5957 30.887C30.6377 30.7143 30.668 30.5207 30.6867 30.306C30.7054 30.0913 30.7194 29.8767 30.7287 29.662L30.7917 28.29H33.6407V32H32.9687V28.682L33.1297 28.878H31.2257L31.3797 28.675L31.3307 29.704C31.3167 30.0307 31.291 30.3363 31.2537 30.621C31.2164 30.9057 31.158 31.1553 31.0787 31.37C31.004 31.5847 30.899 31.7527 30.7637 31.874C30.633 31.9953 30.4627 32.056 30.2527 32.056C30.192 32.056 30.1267 32.049 30.0567 32.035C29.9914 32.0257 29.919 32.0117 29.8397 31.993ZM36.5921 32.042C36.1954 32.042 35.8454 31.9603 35.5421 31.797C35.2434 31.6337 35.0101 31.4097 34.8421 31.125C34.6787 30.8403 34.5971 30.5137 34.5971 30.145C34.5971 29.7763 34.6764 29.4497 34.8351 29.165C34.9984 28.8803 35.2201 28.6587 35.5001 28.5C35.7847 28.3367 36.1044 28.255 36.4591 28.255C36.8184 28.255 37.1357 28.3343 37.4111 28.493C37.6864 28.6517 37.9011 28.8757 38.0551 29.165C38.2137 29.4497 38.2931 29.7833 38.2931 30.166C38.2931 30.194 38.2907 30.2267 38.2861 30.264C38.2861 30.3013 38.2837 30.3363 38.2791 30.369H35.1221V29.886H37.9291L37.6561 30.054C37.6607 29.816 37.6117 29.6037 37.5091 29.417C37.4064 29.2303 37.2641 29.0857 37.0821 28.983C36.9047 28.8757 36.6971 28.822 36.4591 28.822C36.2257 28.822 36.0181 28.8757 35.8361 28.983C35.6541 29.0857 35.5117 29.2327 35.4091 29.424C35.3064 29.6107 35.2551 29.8253 35.2551 30.068V30.18C35.2551 30.4273 35.3111 30.649 35.4231 30.845C35.5397 31.0363 35.7007 31.1857 35.9061 31.293C36.1114 31.4003 36.3471 31.454 36.6131 31.454C36.8324 31.454 37.0307 31.4167 37.2081 31.342C37.3901 31.2673 37.5487 31.1553 37.6841 31.006L38.0551 31.44C37.8871 31.636 37.6771 31.7853 37.4251 31.888C37.1777 31.9907 36.9001 32.042 36.5921 32.042ZM39.3356 32V28.29H40.0076V29.865H42.1216V28.29H42.7936V32H42.1216V30.446H40.0076V32H39.3356ZM44.1002 32V28.29H44.7722V32H44.1002ZM44.4362 27.576C44.3056 27.576 44.1959 27.534 44.1072 27.45C44.0232 27.366 43.9812 27.2633 43.9812 27.142C43.9812 27.016 44.0232 26.911 44.1072 26.827C44.1959 26.743 44.3056 26.701 44.4362 26.701C44.5669 26.701 44.6742 26.743 44.7582 26.827C44.8469 26.9063 44.8912 27.0067 44.8912 27.128C44.8912 27.254 44.8492 27.3613 44.7652 27.45C44.6812 27.534 44.5716 27.576 44.4362 27.576Z" fill=${
    activePage == "Відправлені" ? "#6EA8DB" : "#C9C9C9"
  }/>
</g>
</svg>
`;

  const chat = `<svg width="20" height="34" viewBox="0 0 20 34" fill="none" xmlns="http://www.w3.org/2000/svg">
<g id="Group 2675">
<path id="Ellipse 1144 (Stroke)" fill-rule="evenodd" clip-rule="evenodd" d="M9.98741e-06 9.99999C9.98741e-06 4.47715 4.47716 0 10 0C15.5229 0 20 4.47715 20 9.99999C20 15.5229 15.5229 20 10 20C8.50992 20 7.09427 19.6736 5.82217 19.0879L0.841403 19.9886C0.588424 20.0343 0.330377 19.9406 0.165727 19.7432C0.00107784 19.5457 -0.0447706 19.275 0.0456769 19.0344L1.47542 15.2304C0.539674 13.7084 9.98741e-06 11.9163 9.98741e-06 9.99999ZM2.93755 15.4007L1.82573 18.3588L5.80097 17.64L5.80852 17.6387C5.98925 17.6079 6.16568 17.6479 6.30943 17.7386C7.42635 18.2722 8.67728 18.5714 10 18.5714C14.7339 18.5714 18.5714 14.7339 18.5714 9.99999C18.5714 5.26612 14.7339 1.42857 10 1.42857C5.26614 1.42857 1.42858 5.26613 1.42858 9.99999C1.42858 11.7332 1.94224 13.3443 2.8255 14.6919C2.98159 14.884 3.03292 15.1531 2.93755 15.4007Z" fill="${
    activePage == "Чат" ? "#6EA8DB" : "#C9C9C9"
  }"/>
<path id="&#208;&#167;&#208;&#176;&#209;&#130;" d="M7.815 30.012C7.53967 30.1287 7.27133 30.2173 7.01 30.278C6.75333 30.334 6.50367 30.362 6.261 30.362C5.66367 30.362 5.19933 30.2173 4.868 29.928C4.54133 29.6387 4.378 29.2257 4.378 28.689V27.1H5.064V28.612C5.064 28.976 5.176 29.256 5.4 29.452C5.624 29.648 5.93667 29.746 6.338 29.746C6.576 29.746 6.81867 29.7157 7.066 29.655C7.318 29.5943 7.563 29.5057 7.801 29.389L7.815 30.012ZM7.696 32V27.1H8.389V32H7.696ZM12.0803 32V31.216L12.0453 31.069V29.732C12.0453 29.4473 11.9613 29.228 11.7933 29.074C11.63 28.9153 11.3826 28.836 11.0513 28.836C10.832 28.836 10.6173 28.8733 10.4073 28.948C10.1973 29.018 10.02 29.1137 9.8753 29.235L9.5953 28.731C9.78663 28.577 10.0153 28.4603 10.2813 28.381C10.552 28.297 10.8343 28.255 11.1283 28.255C11.637 28.255 12.029 28.3787 12.3043 28.626C12.5796 28.8733 12.7173 29.2513 12.7173 29.76V32H12.0803ZM10.8623 32.042C10.587 32.042 10.3443 31.9953 10.1343 31.902C9.92896 31.8087 9.7703 31.6803 9.6583 31.517C9.5463 31.349 9.4903 31.16 9.4903 30.95C9.4903 30.7493 9.53696 30.5673 9.6303 30.404C9.7283 30.2407 9.88463 30.11 10.0993 30.012C10.3186 29.914 10.6126 29.865 10.9813 29.865H12.1573V30.348H11.0093C10.6733 30.348 10.447 30.404 10.3303 30.516C10.2136 30.628 10.1553 30.7633 10.1553 30.922C10.1553 31.104 10.2276 31.251 10.3723 31.363C10.517 31.4703 10.7176 31.524 10.9743 31.524C11.2263 31.524 11.4456 31.468 11.6323 31.356C11.8236 31.244 11.9613 31.0807 12.0453 30.866L12.1783 31.328C12.0896 31.5473 11.9333 31.7223 11.7093 31.853C11.4853 31.979 11.203 32.042 10.8623 32.042ZM14.6624 32V28.703L14.8304 28.878H13.3044V28.29H16.6924V28.878H15.1734L15.3344 28.703V32H14.6624Z" fill=${
  activePage == "Чат" ? "#6EA8DB" : "#C9C9C9"
}/>
</g>
</svg>
`;
  const navigationFunc = useCallback(
    (to: string) => {
      navigation.navigate(to as keyof TypeRootStackParamList);
      dispatch(setIsMainLayoutShown(false))
      setTimeout(() => {
        setIsActionMenuOpen(false);
      }, 5);
    },
    [navigation]
  );

  const rotateInterpolation = useMemo(
    () =>
      rotationAnim.interpolate({
        inputRange: [0, 1],
        outputRange: ["0deg", "45deg"],
      }),
    [rotationAnim]
  );

  return (
    <SafeAreaProvider>
      <SafeAreaView
        style={{
          backgroundColor: theme === "Food" ? colors.food : colors.nonfood,
        }}
        edges={["top"]}
      >
        <StatusBar barStyle="default" />
        {isMainLayoutShown && (
          <View
            style={[
              styles.upperNav,
              {
                backgroundColor:
                  theme === "Food" ? colors.food : colors.nonfood,
              },
            ]}
          >
            <Text style={styles.activePageText}>{activePage}</Text>
            <TouchableOpacity onPress={() => setIsMenuOpen(!isMenuOpen)}>
              <Image
                source={require("../assets/img/userIcon.png")}
                style={styles.iconUser}
              />
            </TouchableOpacity>
          </View>
        )}
      </SafeAreaView>

      <View style={styles.container}>
        <View style={styles.component}>{children}</View>
        {isMainLayoutShown && (
          <View style={[styles.bottomNav]}>
            <View style={styles.bottomNavContainer}>
              <TouchableOpacity
                style={styles.button}
                onPress={() => navigation.navigate("NotSended")}
              >
                <SvgXml xml={newIcon} style={styles.icon} />
              </TouchableOpacity>
              <TouchableOpacity
                style={styles.button}
                onPress={() => navigation.navigate("Sended")}
              >
                <SvgXml xml={sended} style={styles.icon} />
              </TouchableOpacity>
              <TouchableOpacity
                style={styles.button}
                onPress={() => navigation.navigate("Chat")}
              >
                <SvgXml xml={chat} style={styles.icon} />
              </TouchableOpacity>
            </View>
          </View>
        )}
        {!isMenuOpen && isMainLayoutShown && (
          <TouchableOpacity style={styles.buttonAdd} onPress={toggleRotation}>
            <View style={styles.redContainerButtonAdd}>
              <Animated.Image
                source={require("../assets/img/plusIcon.png")}
                style={[
                  styles.plusIcon,
                  { transform: [{ rotate: rotateInterpolation }] },
                ]}
              />
            </View>
          </TouchableOpacity>
        )}
      </View>

      <Modal
        transparent
        visible={isActionMenuOpen}
        animationType="fade"
        onRequestClose={toggleRotation}
      >
        <BlurView intensity={15} style={styles.overlay}>
          <View style={styles.menu}>
            <TouchableOpacity
              style={styles.menuItem}
              onPress={() => {
                navigationFunc("AddClient");
                toggleRotation();
              }}
            >
              <Text style={styles.menuText}>СТВОРЕННЯ КОНТРАГЕНТА</Text>
            </TouchableOpacity>
            <TouchableOpacity
              style={styles.menuItem}
              onPress={() => {
                navigation.navigate("Address");
                setTimeout(() => {
                  setIsActionMenuOpen(false)
                }, 5)
              }}
            >
              <Text style={styles.menuText}>СТВОРЕННЯ ДОГОВОРУ</Text>
            </TouchableOpacity>
            <TouchableOpacity style={styles.menuItem}>
              <Text style={styles.menuText}>СТВОРЕННЯ ТОРГОВОЇ ТОЧКИ</Text>
            </TouchableOpacity>
            <TouchableOpacity style={styles.menuItem}>
              <Text style={styles.menuText}>ДОДАТИ В МАРШРУТ</Text>
            </TouchableOpacity>
          </View>
        </BlurView>

        <TouchableOpacity style={styles.buttonAdd} onPress={toggleRotation}>
          <View style={styles.redContainerButtonAdd}>
            <Animated.Image
              source={require("../assets/img/plusIcon.png")}
              style={[
                styles.plusIcon,
                { transform: [{ rotate: rotateInterpolation }] },
              ]}
            />
          </View>
        </TouchableOpacity>
      </Modal>

      {isMenuOpen && (
        <UserMenu isMenuOpen={isMenuOpen} setIsMenuOpen={setIsMenuOpen} />
      )}
    </SafeAreaProvider>
  );
};

const styles = StyleSheet.create({
  container: {
    flex: 1,
    justifyContent: "flex-end",
    backgroundColor: "white",
  },
  component: {
    flex: 1,
  },
  bottomNav: {
    height: 60,
    width: "100%",
    borderTopStartRadius: 15,
    borderTopEndRadius: 15,
    backgroundColor: "#344F66",
  },
  bottomNavContainer: {
    height: "100%",
    width: "75%",
    flexDirection: "row",
    justifyContent: "space-around",
    alignItems: "center",
  },
  upperNav: {
    height: 50,
    flexDirection: "row",
    justifyContent: "space-between",
    alignItems: "center",
  },
  iconUser: {
    height: 40,
    width: 40,
    borderRadius: 100,
    marginRight: 20,
  },
  button: {
    alignItems: "center",
    justifyContent: "center",
  },
  icon: {
    height: 34,
    width: 46,
    resizeMode: "contain",
  },
  overlay: {
    flex: 1,
    backgroundColor: "rgba(0, 0, 0, 0.5)",
    justifyContent: "flex-end",
  },
  menu: {
    backgroundColor: "none",
    paddingVertical: 10,
    marginRight: 20,
    alignItems: "flex-end",
    width: "95%",
    alignSelf: "flex-end",
    bottom: 100,
  },
  menuItem: {
    height: 35,
    alignItems: "center",
    justifyContent: "center",
    borderRadius: 100,
    backgroundColor: "#f5f5f5",
    marginVertical: 5,
    flexWrap: "nowrap",
  },
  menuText: {
    fontFamily: "Montserrat-Bold",
    fontSize: 12,
    marginHorizontal: 10,
    color: "#223444",
  },
  buttonAdd: {
    width: 60,
    height: 60,
    position: "absolute",
    bottom: 20,
    right: 25,
    zIndex: 1, // Вищий рівень відображення
    elevation: 5, // Для Android,
  },
  redContainerButtonAdd: {
    width: 60,
    height: 60,
    borderRadius: 100,
    backgroundColor: colors.food,
    justifyContent: "center",
    alignItems: "center",
  },
  plusIcon: {
    width: 27.75,
    height: 27.75,
  },
  activePageText: {
    marginLeft: 15,
    color: "white",
    fontFamily: "Montserrat",
    letterSpacing: 0,
  },
  whiteContainer: {
    width: 20,
    height: 20,
    borderRadius: 100,
    backgroundColor: "white",
    position: "absolute",
    top: 150,
    right: 60,
  },
});

export default MainLayout;
